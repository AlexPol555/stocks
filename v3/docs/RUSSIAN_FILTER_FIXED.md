# üîß Russian Filter Fixed

## ‚ùì **–ü–†–û–ë–õ–ï–ú–ê:**
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ –∞–∫—Ü–∏–∏ (SLM, ACLS, RELY, MDT, NCNO) –≤–º–µ—Å—Ç–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ `INSTRUMENT_STATUS_BASE` –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Å—Ç—Ä–∞–Ω–µ.

## ‚úÖ **–†–ï–®–ï–ù–ò–ï:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∞–ª—é—Ç–µ RUB –∏ ISIN –∫–æ–¥–∞–º RU –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π.

## üîß **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:**

### **1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
```python
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π
if russian_only:
    currency = getattr(share, 'currency', '')
    isin = getattr(share, 'isin', '')
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ RUB –≤–∞–ª—é—Ç—É –∏ RU ISIN
    if currency != 'RUB' and not isin.startswith('RU'):
        continue
```

### **2. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
1. **INSTRUMENT_STATUS_BASE** - –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã API
2. **ShareType** - —Ç–æ–ª—å–∫–æ –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–µ –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
3. **Currency = RUB** - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å
4. **ISIN starts with RU** - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ ISIN –∫–æ–¥—ã

## üìä **–ö–†–ò–¢–ï–†–ò–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò:**

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π:**
- ‚úÖ **INSTRUMENT_STATUS_BASE** - –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- ‚úÖ **SHARE_TYPE_COMMON/PREFERRED** - –æ–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–µ/–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
- ‚úÖ **Currency = RUB** - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å
- ‚úÖ **ISIN starts with RU** - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ ISIN –∫–æ–¥—ã

### **–ò—Å–∫–ª—é—á–∞—é—Ç—Å—è:**
- ‚ùå **ADR/GDR** - –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ/–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç–∞—Ä–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∫–∏
- ‚ùå **USD/EUR** - –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤–∞–ª—é—Ç—ã
- ‚ùå **US/DE/GB ISIN** - –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ ISIN –∫–æ–¥—ã

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 1933 –∞–∫—Ü–∏–π –∏–∑ API

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π:
SLM: SLM Corp (USD)
ACLS: Axcelis Technologies (USD)
RELY: Remitly Global (USD)
MDT: Medtronic (USD)
NCNO: nCino (USD)
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ~200-300 —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π

–ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π:
SBER: –°–±–µ—Ä–±–∞–Ω–∫ (RUB) [RU0009029540]
GAZP: –ì–∞–∑–ø—Ä–æ–º (RUB) [RU0007661625]
LKOH: –õ—É–∫–æ–π–ª (RUB) [RU0009024277]
ROSN: –†–æ—Å–Ω–µ—Ñ—Ç—å (RUB) [RU000A0JXQ28]
VTBR: –í–¢–ë (RUB) [RU000A0JP5V6]
```

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
```python
def load_shares_from_tinkoff_api(self, api_key: str, russian_only: bool = True) -> List[Dict]:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º INSTRUMENT_STATUS_BASE –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    instruments = client.instruments.shares(
        instrument_status=InstrumentStatus.INSTRUMENT_STATUS_BASE
    ).instruments
    
    for share in instruments:
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –∞–∫—Ü–∏–π
        if share_type not in [ShareType.SHARE_TYPE_COMMON, ShareType.SHARE_TYPE_PREFERRED]:
            continue
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π
        if russian_only:
            currency = getattr(share, 'currency', '')
            isin = getattr(share, 'isin', '')
            
            # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ RUB –≤–∞–ª—é—Ç—É –∏ RU ISIN
            if currency != 'RUB' and not isin.startswith('RU'):
                continue
```

## üìà **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

### **1. –¢–æ—á–Ω–æ—Å—Ç—å:**
- **–¢–æ–ª—å–∫–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏** - RUB –≤–∞–ª—é—Ç–∞ + RU ISIN
- **–ò—Å–∫–ª—é—á–µ–Ω—ã –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ** - USD, EUR, US ISIN, DE ISIN
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### **2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **INSTRUMENT_STATUS_BASE** - –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç API
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** - —Ç–æ—á–Ω—ã–π –æ—Ç–±–æ—Ä
- **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∞–∫—Ü–∏–∏

### **3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏** - –≤–∞–ª—é—Ç–∞ + ISIN
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–æ–∏—Ö —É—Å–ª–æ–≤–∏–π
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## üöÄ **–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:**

### **1. –í Streamlit:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "‚è∞ Multi-Timeframe"
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "üìà Shares Integration"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–º–µ—á–µ–Ω —á–µ–∫–±–æ–∫—Å "üá∑üá∫ –¢–æ–ª—å–∫–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏"
4. –ù–∞–∂–º–∏—Ç–µ "üîÑ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ü–∏–∏"

### **2. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ:**
```python
from core.shares_integration import SharesIntegrator

integrator = SharesIntegrator()

# –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏ (INSTRUMENT_STATUS_BASE + RUB + RU ISIN)
russian_shares = integrator.load_shares_from_tinkoff_api(api_key, russian_only=True)

# –í—Å–µ –∞–∫—Ü–∏–∏ (INSTRUMENT_STATUS_ALL)
all_shares = integrator.load_shares_from_tinkoff_api(api_key, russian_only=False)
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
python test_russian_filter_fixed.py
```

## üìä **–õ–û–ì–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò:**

### **–†–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏:**
```
Loading Russian shares using INSTRUMENT_STATUS_BASE filter
Loaded 245 Russian shares using API filter (from 1933 total)
```

### **–í—Å–µ –∞–∫—Ü–∏–∏:**
```
Loading all shares using INSTRUMENT_STATUS_ALL filter
Loaded 1933 shares using API filter (from 1933 total)
```

## üîç **–ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê:**

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏:**
- **SBER** - –°–±–µ—Ä–±–∞–Ω–∫ (RUB) [RU0009029540]
- **GAZP** - –ì–∞–∑–ø—Ä–æ–º (RUB) [RU0007661625]
- **LKOH** - –õ—É–∫–æ–π–ª (RUB) [RU0009024277]
- **ROSN** - –†–æ—Å–Ω–µ—Ñ—Ç—å (RUB) [RU000A0JXQ28]
- **VTBR** - –í–¢–ë (RUB) [RU000A0JP5V6]

### **–ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –∞–∫—Ü–∏–∏:**
- **SLM** - SLM Corp (USD) [US78442G1030]
- **ACLS** - Axcelis Technologies (USD) [US05465C1009]
- **RELY** - Remitly Global (USD) [US75972B1000]
- **MDT** - Medtronic (USD) [US5951121038]
- **NCNO** - nCino (USD) [US63938C1080]

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**
–¢–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- **–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏** (RUB + RU ISIN)
- **–ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –∞–∫—Ü–∏–∏** (USD, EUR, US ISIN)
- **–¢–æ—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ Streamlit –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é!** üá∑üá∫
