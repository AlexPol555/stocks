# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ event loop

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ Streamlit –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
RuntimeError: no running event loop
```

## –ü—Ä–∏—á–∏–Ω–∞
–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø–æ—Ç–æ–º—É, —á—Ç–æ –º—ã –ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.create_task()` –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Streamlit. –í Streamlit –Ω–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ event loop, –ø–æ—ç—Ç–æ–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç threading
**–§–∞–π–ª:** `core/scheduler/real_integration.py`
```python
import threading
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è event loop
**–§–∞–π–ª:** `core/scheduler/real_integration.py`
```python
self._loop_thread = None
self._loop = None
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ event loop –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
**–§–∞–π–ª:** `core/scheduler/real_integration.py`
```python
def _run_loop(self):
    """Run the event loop in a separate thread."""
    self._loop = asyncio.new_event_loop()
    asyncio.set_event_loop(self._loop)
    self._loop.run_forever()
```

### 4. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã –º–µ—Ç–æ–¥—ã start() –∏ stop()
**–§–∞–π–ª:** `core/scheduler/real_integration.py`

#### –ú–µ—Ç–æ–¥ start():
- –ó–∞–ø—É—Å–∫–∞–µ—Ç event loop –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon –ø–æ—Ç–æ–∫–µ
- –ñ–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ event loop
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.run_coroutine_threadsafe()` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

#### –ú–µ—Ç–æ–¥ stop():
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —á–µ—Ä–µ–∑ `asyncio.run_coroutine_threadsafe()`
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç event loop —á–µ—Ä–µ–∑ `call_soon_threadsafe()`
- –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º

### 5. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ running
**–§–∞–π–ª:** `core/scheduler/real_integration.py`
```python
@property
def running(self):
    """Check if scheduler is running."""
    return self.scheduler.running and self._loop_thread is not None and self._loop_thread.is_alive()
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `RuntimeError: no running event loop`
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- ‚úÖ Streamlit UI –º–æ–∂–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- Event loop –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ daemon –ø–æ—Ç–æ–∫–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `asyncio.run_coroutine_threadsafe()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞

## –°—Ç–∞—Ç—É—Å
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –≤ Streamlit! üéâ
